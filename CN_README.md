# comfyui\comfyui_proportion_solver

**注意：** 本项目由 AI (gemini_advanced-gemini_2.5_pro) 撰写，旨在提供高效的比例优化解决方案。通过多轮对话，项目从核心代码逐步迭代，最终以 ComfyUI 节点的便利形式呈现。

-----

## 环境需求

  * **Python 依赖：** `numpy`
  * **深度学习框架：** `torch` (ComfyUI 用户通常已具备此环境，故不作特别说明)

-----

## 使用教程

1.  **安装节点：** 将本项目文件放置于 ComfyUI 的 `custom_nodes` 文件夹中。
2.  **启动 ComfyUI：** 重新启动 ComfyUI 界面。
3.  **加载工作流：** 推荐使用我们提供的工作流文件进行体验：![alt text](image.png)
4.  **下载加速lora** 示例使用的hyper，你当然可以使用其他的加速lora（并通过调节点实现控制比例，合适时lora不影响质量）

-----

## 插件节点介绍

本插件共包含两个核心节点，分别用于不同复杂度的比例优化任务：

### 1\. Proportion Optimization Solver (比例优化求解器)

这是一个**基础**的比例优化求解工具。

  * **核心功能：** 根据您设定的三个目标“生成率” (`target_generation_rate_1` 到 `3`)，通过**标准梯度下降算法**，自动计算出三个能最优匹配这些比率的“降噪”参数 (`denoise_1` 到 `3`)。
  * **适用场景：** 当您需要快速、直接地解决一个基础的比例分配问题时，此节点是理想的入门选择。

-----

### 2\. Proportion Optimization Solver (Advanced) (比例优化求解器 - 高级)

这是求解器的**专家版本**，专为更复杂、更精细的优化任务而设计。

  * **核心功能：**
      * 不仅计算三个“降噪”参数，还会**额外计算四个“步数”参数** (`step_1` 到 `4`)，以实现更灵活的控制。
      * 采用更强大的 **Adam 优化器**，并结合了**余弦退火学习率 (Cosine Annealing Learning Rate)** 和**热重启策略 (Warm Restarts)**，能更有效地探索并找到高质量的解决方案。
  * **高级控制：** 您可以通过大量的**超参数**（如正则化、稳定权重、整数靠拢强度等）来精细地引导优化过程。例如，您可以配置参数来促使“步数”参数收敛到整数值。
  * **输出结果：** 节点同时提供**原始浮点数**和**四舍五入后的整数**两种结果，方便您根据实际需求直接应用。
  * **适用场景：** 当基础版节点无法满足您的精度要求，或者您需要对解的特性（如强制取整、更平滑的收敛）进行更严格控制时，应优先考虑使用此高级版本。
